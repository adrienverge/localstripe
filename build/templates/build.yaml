# This template performs the following build tasks:
# - Linting
# - Compilation
# - Unit testing

parameters:
  region: eastus
  environment: development

steps:
  - task: Docker@2
    displayName: Build docker image
    inputs:
      repository: mocks/localstripe
      command: build
      containerRegistry: Azure quadpay container registry
      tags: |
        latest
        $(Build.BuildNumber)
  - ${{ if or( eq(variables['Build.SourceBranch'], 'refs/heads/qp-mock-master'), eq(variables['Build.Reason'], 'Manual') ) }}:
    - task: Docker@2
      displayName: Push docker image
      inputs:
        repository: mocks/localstripe
        command: push
        containerRegistry: Azure quadpay container registry
        tags: |
          latest
          $(Build.BuildNumber)
